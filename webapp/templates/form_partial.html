<form onsubmit="doSubmit(event)">
  {% for field in fields %}
    <div class="mb-3">
      <label for="{{ field.key }}" class="form-label">{{ field.label }}</label>

      {% if field.type == 'text' or field.type == 'string' %}
        <input type="text" class="form-control" id="{{ field.key }}" name="{{ field.key }}" 
          value="{{ data.get(field.key.split('.')[-1], '') }}" {% if field.required %}required{% endif %}>

      {% elif field.type == 'number' or field.type == 'integer' %}
        <input type="number" class="form-control" id="{{ field.key }}" name="{{ field.key }}" 
          value="{{ data.get(field.key.split('.')[-1], '') }}" {% if field.required %}required{% endif %}>

      {% elif field.type == 'textarea' %}
        <textarea class="form-control" id="{{ field.key }}" name="{{ field.key }}" {% if field.required %}required{% endif %}>{{ data.get(field.key.split('.')[-1], '') }}</textarea>

      {% elif field.type == 'select' %}
        <select class="form-select" id="{{ field.key }}" name="{{ field.key }}" {% if field.required %}required{% endif %}>
          {% for option in field.options %}
            <option value="{{ option }}" {% if data.get(field.key.split('.')[-1]) == option %}selected{% endif %}>
              {{ option }}
            </option>
          {% endfor %}
        </select>
      {% endif %}
    </div>
  {% endfor %}
  
  <div class="d-flex gap-2">
    <button type="submit" class="btn btn-success">Save</button>
    <a href="{{ url_for('entity_dashboard', entity_type=entity_type) }}" class="btn btn-outline-secondary">Cancel</a>
  </div>
</form>